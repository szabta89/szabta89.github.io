Pattern Function Module FindBugs                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Class is final but declares protected field. 
   
  @param clazz the class 
 */ 
def CI_CONFUSED_INHERITANCE(clazz : ClassConcept) : Void = { 
  assert clazz.isFinal == true 
  member := clazz.member 
  assert member instanceOf FieldDeclaration 
  assert member.visibility instanceOf PrivateVisibility 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Abstract class defines covariant equals() method. 
   
  @param class the class 
 */ 
def EQ_ABSTRACT_SELF(class : ClassConcept) : Void = { 
  method := class.member 
  assert method instanceOf InstanceMethodDeclaration 
   
  // check method name and return type 
  name := method.name 
  assert method.returnType instanceOf BooleanType 
  assert name == "equals" 
   
  // assert that the method has only one parameter 
  assert count getParameters(method) == 1 
   
  // and check that the parameter's type is the same as the class 
  parameter := getParameters(method) 
  parameterType := parameter.type 
  assert parameterType instanceOf ClassifierType 
  assert class == parameterType.classifier 
}                                                                                                                                                                                                                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Class defines covariant compareTo() method. 
   
  @param class the class 
 */ 
def CO_SELF_NO_OBJECT(class : ClassConcept) : Void = { 
  // check that the class implements the Comparable interface 
  assert def comparables(class) 
   
  method := class.member 
  assert method instanceOf InstanceMethodDeclaration 
   
  // check method name and return type 
  name := method.name 
  assert method.returnType instanceOf IntegerType 
  assert name == "compareTo" 
   
  // assert that the method has only one parameter 
  assert count getParameters(method) == 1 
   
  // and check that the parameter's type is not Object 
  parameter := getParameters(method) 
  parameterType := parameter.type 
  assert parameterType instanceOf ClassifierType 
  assert eval(!parameterType.classifier.name.equals(Object.class.getSimpleName())) 
}                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Class is Serializable but its superclass doesn't define a void constructor. 
   
  @param class the class 
 */ 
def SE_NO_SUITABLE_CONSTRUCTOR(class : ClassConcept) : Void = { 
  superClass := class.superclass.classifier 
  assert def serializables(class) 
  assert undef serializables(superClass) 
  assert undef noArgConstructor(superClass) 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Enumerates methods that perform dubious catching of IllegalMonitorStateException. 
   
  @param method the method 
 */ 
def IMSE_DONT_CATCH_IMSE(method : BaseMethodDeclaration) : Void = { 
  assert catchClause instanceOf CatchClause 
  type := catchClause.throwable.type 
  assert type instanceOf ClassifierType 
  assert type.classifier.name == "IllegalMonitorStateException" 
  assert method == eval(catchClause.ancestor<concept = BaseMethodDeclaration>) 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Enumerates unused fields. 
   
  @param field the field 
 */ 
def UUF_UNUSED_FIELD(field : FieldDeclaration) : Void = { 
  assert undef referencedVariables(field) 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  A class' finalize() method should have protected access, not public. 
   
  @param class the class 
 */ 
def FI_PUBLIC_SHOULD_BE_PROTECTED(class : ClassConcept) : Void = { 
  method := class.member 
  assert method instanceOf InstanceMethodDeclaration 
   
  // check method name and return type 
  name := method.name 
  type := method.returnType 
  assert name == "finalize" 
  assert type instanceOf VoidType 
   
  // assert that the method has no parameters 
  assert count getParameters(method) == 0 
   
  // assert that the method's visibility is public 
  assert method.visibility instanceOf PublicVisibility 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Method invokes the dangerous runFinalizersOnExit method. 
   
  @param class the class that contains the method 
 */ 
def DM_RUN_FINALIZERS_ON_EXIT(class : ClassConcept) : Void = { 
  assert call instanceOf StaticMethodCall 
  assert call.staticMethodDeclaration.name == "runFinalizersOnExit" 
  classifier := call.classConcept 
  assert eval(classifier.name.equals(Runtime.class.getSimpleName()) || classifier.name.equals(System.class.getSimpleName())) 
  assert class == eval(call.ancestor<concept = ClassConcept>) 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Class defines equals() and does not define hashCode(). 
   
  @param class the class 
 */ 
def HE_EQUALS_USE_HASHCODE(class : ClassConcept) : Void = { 
  assert def getEqualsMethod(class) 
  assert undef getHashCodeMethod(class) 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Enumerates binary operations which compare String objects using == or !=. 
   
  @param op the binary operation 
 */ 
def ES_COMPARING_STRINGS_WITH_EQ(op : BinaryOperation) : Void = { 
  assert def ES_COMPARING_STRINGS_WITH_EQ0(op) 
  assert op instanceOf NotEqualsExpression 
} alt { 
  assert def ES_COMPARING_STRINGS_WITH_EQ0(op) 
  assert op instanceOf EqualsExpression 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Helper function of ES_COMPARING_STRINGS_WITH_EQ. 
  Looks up string literals or string-typed variable references  
  on the  two sides of the binary operation. 
   
  @param op the binary operation 
 */ 
helper def ES_COMPARING_STRINGS_WITH_EQ0(op : BinaryOperation) : Void = { 
  (left, right) := getBinaryParts(op) 
  assert left instanceOf StringLiteral 
  assert right instanceOf StringLiteral 
} alt { 
  (left, right) := getBinaryParts(op) 
  assert left instanceOf VariableReference 
  var := left.variableDeclaration 
  assert def getVariablesWithStringType(var) 
  assert right instanceOf StringLiteral 
} alt { 
  (left, right) := getBinaryParts(op) 
  assert left instanceOf StringLiteral 
  assert right instanceOf VariableReference 
  var := right.variableDeclaration 
  assert def getVariablesWithStringType(var) 
} alt { 
  (left, right) := getBinaryParts(op) 
  assert left instanceOf VariableReference 
  var1 := left.variableDeclaration 
  assert def getVariablesWithStringType(var1) 
  assert right instanceOf VariableReference 
  var2 := right.variableDeclaration 
  assert def getVariablesWithStringType(var2) 
}
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
// HELPER FUNCTIONS BELOW                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Returns the left and right hand side expressions of a binary operation. 
   
  @param op the binary operation 
  @return the left and right hand side expressions 
 */ 
helper def getBinaryParts(op : BinaryOperation) : (Expression, Expression) = { 
  left := op.leftExpression 
  right := op.rightExpression 
  return (left, right) 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Enumerates the variable declaration(s) with string type. 
   
  @param var the variable declaration 
 */ 
helper def getVariablesWithStringType(var : VariableDeclaration) : Void = { 
  assert var.type instanceOf StringType 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Returns the equals method of the given class.  
   
  @param class the class 
  @return the hashCode method 
 */ 
helper def getEqualsMethod(class : ClassConcept) : InstanceMethodDeclaration = { 
  method := class.member 
  assert method instanceOf InstanceMethodDeclaration 
   
  // check method name and return type 
  name := method.name 
  assert method.returnType instanceOf BooleanType 
  assert name == "equals" 
   
  // assert that the method has only one parameter 
  assert count getParameters(method) == 1 
   
  // and check that the parameter's type is Object 
  parameter := getParameters(method) 
  parameterType := parameter.type 
  assert parameterType instanceOf ClassifierType 
  assert parameterType.classifier.name == "Object" 
   
  return method 
}                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Returns the hashCode method of the given class.  
   
  @param class the class 
  @return the hashCode method 
 */ 
helper def getHashCodeMethod(class : ClassConcept) : InstanceMethodDeclaration = { 
  method := class.member 
  assert method instanceOf InstanceMethodDeclaration 
   
  // check method name and return type 
  name := method.name 
  assert method.returnType instanceOf IntegerType 
  assert name == "hashCode" 
   
  // assert that the method has no parameters 
  assert count getParameters(method) == 0 
   
  return method 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Enumerates variables that are referenced. 
   
  @param variable the variable 
 */ 
helper def referencedVariables(variable : VariableDeclaration) : Void = { 
  assert reference instanceOf VariableReference 
  assert variable == reference.variableDeclaration 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Returns the superclass of the given class. 
   
  @param class the class 
  @return the superclass 
 */ 
helper def getSuperClass(class : ClassConcept) : ClassConcept = { 
  super := class.superclass.classifier 
  assert super instanceOf ClassConcept 
  return super 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Returns the no-arg constructor of the given class. 
   
  @param class the class 
  @return the no-arg constructor 
 */ 
helper def noArgConstructor(class : ClassConcept) : ConstructorDeclaration = { 
  constructor := class.member 
  assert constructor instanceOf ConstructorDeclaration 
  assert count getParameters(constructor) == 0 
  return constructor 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Enumerates the classes that implement the Comparable interface. 
   
  @param class the class 
 */ 
helper def comparables(class : ClassConcept) : Void = { 
  interface := class.implementedInterface 
  assert eval(interface.classifier.name.equals(Comparable.class.getName())) 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Enumerates the classes that implement the Serializable interface. 
   
  @param class the class 
 */ 
helper def serializables(class : ClassConcept) : Void = { 
  interface := class.implementedInterface 
  assert eval(interface.classifier.name.equals(Serializable.class.getName())) 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    
/** 
  Returns the parameter(s) of the given method. 
   
  @param method the method 
  @return the parameter(s) 
 */ 
helper def getParameters(method : BaseMethodDeclaration) : ParameterDeclaration = { 
  return method.parameter 
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            